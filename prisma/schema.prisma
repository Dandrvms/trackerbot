generator client {
    provider            = "prisma-client-js"
    output              = "../src/generated/prisma"
}

datasource db {
    provider            = "postgresql"
    url                 = env("DATABASE_URL")
}

model Users {
    id                  Int         @id @default(autoincrement())
    chat_id             String      @unique
    board               Boards[]
    tracking            Trackings[]
    salt                String      @default("")
    trackall            Boolean     @default(false)
}

model ManagePosts {
    id                  Int @id @default(autoincrement())
    externalId          String
    preview             String
    userStateId         Int
    userState           User_States @relation(fields: [userStateId], references: [id], onDelete: Cascade)
    expiresAt           DateTime
    boardId             String

    @@index([userStateId])
    @@unique([externalId, userStateId])

}


model Boards {
    id                  Int    @id @default(autoincrement())
    name                String
    userId              Int
    user                Users  @relation(fields: [userId], references: [id])
}

model Trackings {
    id                  Int     @id @default(autoincrement())
    postId              Int
    userId              Int
    content             String?
    user                Users   @relation(fields: [userId], references: [id])
}

model UserSession {
    userId              String   @id
    pin                 String
    expires             DateTime
}

model User_States {
    id                  Int          @id @default(autoincrement())
    userId              String       @unique
    step                String?
    previousStep        String?
    menus               Menus[]
    scanSession         ScanSession?
    managedPosts        ManagePosts[]
    postId              Int?
    boardId             String?
    content             String?
    commentContent      String?
    commentId           Int?
    updatedAt           DateTime     @updatedAt
    createdAt           DateTime     @default(now())
}

model Menus {
    id                  Int         @id @default(autoincrement())
    messageId           Int         @unique
    currentPage         Int?
    type                String
    isActive            Boolean     @default(true)
    userStateId         Int
    userState           User_States @relation(fields: [userStateId], references: [id], onDelete: Cascade)
    createdAt           DateTime    @default(now())
}

model ScanSession {
    id                  Int      @id @default(autoincrement())
    createdAt           DateTime @default(now())
    expiresAt           DateTime
    userStateId         Int     @unique
    userState           User_States @relation(fields: [userStateId], references: [id], onDelete: Cascade)

    scanPosts           ScanPost[]

    @@index([userStateId])
}

model ScanPost {
    id                  Int    @id @default(autoincrement())
    sessionId           Int
    boardId             String @default("")
    externalId          String        
    preview             String  

    comments            ScanComment[]

    session             ScanSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

    @@index([sessionId])
}


model ScanComment {
    id                  Int    @id @default(autoincrement())
    postId              Int

    externalId          String
    preview             String

    post                ScanPost @relation(fields: [postId], references: [id], onDelete: Cascade)

    @@index([postId])
}

